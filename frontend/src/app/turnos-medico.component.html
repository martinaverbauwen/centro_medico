<div class="turnos-medico-container">
  <h2>Agenda de Turnos del Médico</h2>

  <div *ngIf="error" class="error">{{ error }}</div>

  <!-- Filtros por estado -->
  <div class="estado-filtros">
    <button [class.active]="filtroEstado==='todos'" (click)="setFiltro('todos')">Todos</button>
    <button [class.active]="filtroEstado==='pendiente'" (click)="setFiltro('pendiente')">Pendientes</button>
    <button [class.active]="filtroEstado==='confirmado'" (click)="setFiltro('confirmado')">Confirmados</button>
    <button [class.active]="filtroEstado==='cancelado'" (click)="setFiltro('cancelado')">Cancelados</button>
    <button [class.active]="filtroEstado==='atendido'" (click)="setFiltro('atendido')">Atendidos</button>
  </div>

  <!-- Calendario visual con badges -->
  <div class="calendario-container">
    <div class="calendario-header-bar">
      <button class="calendario-arrow" (click)="cambiarMes(-1)">&#8592;</button>
      <h3>{{ monthName | titlecase }} {{ currentYear }}</h3>
      <button class="calendario-arrow" (click)="cambiarMes(1)">&#8594;</button>
    </div>

    <div class="calendario-grid">
      <div class="calendario-day calendario-header" *ngFor="let d of ['Dom','Lun','Mar','Mié','Jue','Vie','Sáb']">{{ d }}</div>

      <!-- espacios vacíos -->
      <div *ngFor="let empty of [].constructor(firstDayOfWeek)"></div>

      <!-- días del mes -->
      <div
        *ngFor="let day of [].constructor(daysInMonth); let i = index"
        class="calendario-day"
        [class.selected]="selectedDate?.getDate() === i+1 && selectedDate?.getMonth() === currentMonth && selectedDate?.getFullYear() === currentYear"
        (click)="selectDay(i+1)"
        [title]="previewDia(i+1)">
        <span class="cal-dia">{{ i+1 }}</span>

        <!-- badge con cantidad de turnos -->
        <span class="cal-badge" *ngIf="countDia(i+1) > 0">{{ countDia(i+1) }}</span>
      </div>
    </div>
  </div>

  <!-- Agenda del día seleccionado -->
  <div *ngIf="selectedDate" class="calendario-agenda">
    <h3>Turnos para {{ selectedDate | date:'dd/MM/yyyy' }}</h3>

    <table class="turnos-table" *ngIf="turnosDelDia().length">
      <thead>
        <tr>
          <th>Hora</th>
          <th>Paciente</th>
          <th>Especialidad</th>
          <th>Estado</th>
          <th>Médico</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let turno of turnosDelDia()">
          <td>{{ turno.fecha_hora | date:'HH:mm' }}</td>
          <td>{{ turno.paciente?.nombre }} {{ turno.paciente?.apellido }}</td>
          <td>{{ turno.especialidad?.nombre }}</td>
          <td class="estado-cell" [attr.data-estado]="turno.estado">{{ turno.estado }}</td>
          <td>{{ turno.medico?.nombre }} {{ turno.medico?.apellido }}</td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!turnosDelDia().length" class="no-turnos">
      No hay turnos para este día.
    </div>
  </div>

  <!-- Próximos turnos (atajo) -->
  <div class="proximos">
    <h3>Próximos turnos</h3>
    <div *ngIf="!proximosTurnos().length" class="no-turnos">No hay turnos próximos.</div>
    <ul *ngIf="proximosTurnos().length">
      <li *ngFor="let t of proximosTurnos()">
        <span class="pr-fecha">{{ t.fecha_hora | date:'dd/MM HH:mm' }}</span>
        <span class="pr-pac">{{ t.paciente?.apellido }}, {{ t.paciente?.nombre }}</span>
        <span class="pr-esp">{{ t.especialidad?.nombre }}</span>
        <span class="pr-estado" [attr.data-estado]="t.estado">{{ t.estado }}</span>
      </li>
    </ul>
  </div>
</div>
